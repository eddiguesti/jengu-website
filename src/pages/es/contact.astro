---
import BaseLayout from '../../components/layout/BaseLayout.astro';
import { generateSEO } from '../../lib/seo/metadata';
import { generateOrganizationSchema, generateBreadcrumbSchema } from '../../lib/seo/jsonld';

const seo = generateSEO({
  title: 'Contáctanos - Reserva Tu Consulta Gratuita de IA',
  description: 'Programa una consulta gratuita de 30 minutos para discutir automatización con IA para tu negocio turístico. Envíanos un email a info@jengu.ai o reserva una videollamada. Obtén asesoramiento experto en chatbots, automatización y ROI.',
  canonical: `${Astro.site}es/contact/`,
  ogType: 'website'
});

const jsonLd = [
  generateOrganizationSchema(),
  generateBreadcrumbSchema([
    { name: 'Inicio', url: Astro.site?.href || '' },
    { name: 'Contacto', url: `${Astro.site}es/contact/` }
  ])
];
---

<BaseLayout seo={seo} jsonLd={jsonLd}>
  <!-- Contact Section -->
  <section class="contact-section">
    <div class="contact-container">
      <!-- Contact Info -->
      <div class="contact-info">
        <div class="contact-card">
          <div class="contact-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <h3>Envíanos un Email</h3>
          <p>Para consultas generales y soporte</p>
          <a href="mailto:info@jengu.ai">info@jengu.ai</a>
        </div>

        <div class="contact-card">
          <div class="contact-icon">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <h3>Reserva una Demo</h3>
          <p>Programa una consulta personalizada de 30 minutos para discutir tus necesidades de automatización</p>
          <a href="#" onclick="openBookingModal(); return false;">Reservar Ahora →</a>
        </div>

        <div class="contact-card">
          <div class="contact-icon">
            <i class="fas fa-calculator"></i>
          </div>
          <h3>Calcula tu ROI</h3>
          <p>Visualiza tus ahorros potenciales en 2 minutos</p>
          <a href="/es/calculator">Probar Calculadora →</a>
        </div>
      </div>

      <!-- Contact Form -->
      <div class="contact-form-wrapper">
        <h2>Envíanos un Mensaje</h2>
        <p style="color: var(--gray); margin-bottom: 2rem;">Completa el formulario a continuación y nos pondremos en contacto contigo en 24 horas</p>

        <form id="contactForm" onsubmit="handleSubmit(event)">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">Nombre *</label>
              <input type="text" id="firstName" name="firstName" required>
            </div>
            <div class="form-group">
              <label for="lastName">Apellido *</label>
              <input type="text" id="lastName" name="lastName" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">Correo Electrónico *</label>
              <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
              <label for="phone">Teléfono</label>
              <input type="tel" id="phone" name="phone">
            </div>
          </div>

          <div class="form-group">
            <label for="businessType">Tipo de Negocio *</label>
            <select id="businessType" name="businessType" required>
              <option value="">Selecciona tu tipo de negocio</option>
              <option value="hotel">Hotel</option>
              <option value="resort">Resort</option>
              <option value="campsite">Camping/Parque de Vacaciones</option>
              <option value="bnb">Casa de Huéspedes / B&B</option>
              <option value="travel-agency">Agencia de Viajes</option>
              <option value="tour-operator">Operador Turístico</option>
              <option value="other">Otro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="interest">¿En qué estás interesado? *</label>
            <select id="interest" name="interest" required>
              <option value="">Selecciona un servicio</option>
              <option value="chatbot">Chatbots de IA y Bots Telefónicos</option>
              <option value="software">Desarrollo de Software Personalizado</option>
              <option value="api">Integraciones API</option>
              <option value="email">Automatización de Correos</option>
              <option value="pricing">Precios Dinámicos</option>
              <option value="full">Suite Completa de Automatización</option>
              <option value="consultation">Solo Explorando / Consultoría</option>
            </select>
          </div>

          <div class="form-group">
            <label for="message">Cuéntanos sobre tus necesidades *</label>
            <textarea id="message" name="message" required placeholder="Describe tus desafíos actuales y qué buscas lograr..."></textarea>
          </div>

          <button type="submit" class="submit-btn">
            <i class="fas fa-paper-plane"></i> Enviar Mensaje
          </button>
        </form>
      </div>
    </div>
  </section>

  <!-- Booking CTA -->
  <section class="calendly-section">
    <div class="calendly-container">
      <h2>¿Prefieres Hablar? <span class="gradient-text">Reserva una Llamada</span></h2>
      <p>
        Programa una consulta de video de 30 minutos con nuestro equipo. Discutiremos tus necesidades específicas, te mostraremos ejemplos y verás exactamente cómo la automatización con IA puede transformar tu negocio.
      </p>
      <button onclick="openBookingModal()" class="calendly-btn">
        <i class="fas fa-video"></i> Reserva una Consulta
      </button>
    </div>
  </section>

  <!-- Form Submission Script -->
  <script is:inline>
    async function handleSubmit(event) {
      event.preventDefault();

      const submitButton = event.target.querySelector('button[type="submit"]');
      const originalButtonText = submitButton.innerHTML;

      try {
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData);

        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.error || 'Error al enviar el mensaje');
        }

        alert('✅ ¡Gracias por tu mensaje! Nos pondremos en contacto contigo en 24 horas.');
        event.target.reset();

      } catch (error) {
        console.error('Error al enviar el formulario:', error);
        alert('❌ ' + (error.message || 'Ocurrió un error. Por favor intenta nuevamente o envíanos un correo a info@jengu.ai'));
      } finally {
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
      }
    }
  </script>
</BaseLayout>
