---
// CRO-Optimized Discovery Call Booking Modal - 2026 Best Practices
---

<!-- Booking Modal -->
<div class="booking-modal" id="bookingModal">
  <div class="booking-modal-overlay" id="bookingModalOverlay"></div>
  <div class="booking-modal-content">
    <button class="booking-modal-close" id="bookingModalClose" aria-label="Close booking modal">
      <i class="fas fa-times"></i>
    </button>

    <!-- Trust Badge Banner -->
    <div class="trust-banner">
      <div class="trust-item">
        <i class="fas fa-shield-check"></i>
        <span>Secure Booking</span>
      </div>
      <div class="trust-item">
        <i class="fas fa-calendar-check"></i>
        <span>Instant Confirmation</span>
      </div>
      <div class="trust-item">
        <i class="fas fa-clock"></i>
        <span>Free Cancellation</span>
      </div>
    </div>

    <div class="booking-container">
      <!-- Left Side: Form -->
      <div class="booking-left">
        <div class="booking-header">
          <div class="booking-header-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <h2>Book Your Free Discovery Call</h2>
          <p class="booking-duration">
            <i class="fas fa-clock"></i> 30 minutes ¬∑ No credit card required
          </p>
        </div>

        <!-- Value Proposition -->
        <div class="value-prop">
          <h3>What you'll get:</h3>
          <div class="value-list">
            <div class="value-item">
              <i class="fas fa-check-double"></i>
              <span>Custom AI automation roadmap for your business</span>
            </div>
            <div class="value-item">
              <i class="fas fa-check-double"></i>
              <span>ROI projections and cost-benefit analysis</span>
            </div>
            <div class="value-item">
              <i class="fas fa-check-double"></i>
              <span>Immediate actionable insights you can implement</span>
            </div>
          </div>
        </div>

        <form class="booking-form" id="bookingForm" novalidate>
          <div class="form-group">
            <label for="fullName">
              <i class="fas fa-user"></i> Your Name *
            </label>
            <input
              type="text"
              id="fullName"
              name="fullName"
              required
              placeholder="John Doe"
              autocomplete="name"
              data-error="Please enter your name"
            >
            <span class="field-error" id="nameError"></span>
            <div class="field-success"><i class="fas fa-check"></i></div>
          </div>

          <div class="form-group">
            <label for="email">
              <i class="fas fa-envelope"></i> Work Email *
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="john@company.com"
              autocomplete="email"
              data-error="Please enter a valid email"
            >
            <span class="field-error" id="emailError"></span>
            <div class="field-success"><i class="fas fa-check"></i></div>
            <p class="field-hint">We respect your privacy. No spam, ever.</p>
          </div>

          <div class="form-group">
            <label for="phone">
              <i class="fas fa-phone"></i> Phone Number (optional, for reminders)
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder="+1 (555) 000-0000"
              autocomplete="tel"
            >
            <p class="field-hint">We'll send you a reminder before the call</p>
          </div>

          <div class="form-group">
            <label for="company">
              <i class="fas fa-building"></i> Company Name
            </label>
            <input
              type="text"
              id="company"
              name="company"
              placeholder="Your Company"
              autocomplete="organization"
            >
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-video"></i> How would you like to meet? *
            </label>
            <div class="platform-options">
              <label class="platform-option">
                <input type="radio" name="platform" value="teams" required>
                <span class="platform-card">
                  <i class="fab fa-microsoft"></i>
                  <span>Teams</span>
                  <span class="platform-badge">Most Popular</span>
                </span>
              </label>
              <label class="platform-option">
                <input type="radio" name="platform" value="zoom">
                <span class="platform-card">
                  <i class="fas fa-video"></i>
                  <span>Zoom</span>
                </span>
              </label>
              <label class="platform-option">
                <input type="radio" name="platform" value="phone">
                <span class="platform-card">
                  <i class="fas fa-phone-alt"></i>
                  <span>Phone</span>
                </span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="message">
              <i class="fas fa-lightbulb"></i> What's your biggest challenge right now?
            </label>
            <textarea
              id="message"
              name="message"
              rows="3"
              placeholder="e.g., 'We're spending 20 hours/week on manual data entry...'"
              maxlength="500"
            ></textarea>
            <div class="char-counter"><span id="charCount">0</span>/500</div>
          </div>
        </form>

        <!-- Privacy & Trust -->
        <div class="booking-footer">
          <div class="privacy-note">
            <i class="fas fa-lock"></i>
            <span>Your information is secure and will never be shared. View our <a href="/privacy" target="_blank">Privacy Policy</a></span>
          </div>
        </div>
      </div>

      <!-- Right Side: Calendar & Time Slots -->
      <div class="booking-right">
        <!-- Progress Indicator -->
        <div class="booking-progress">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <span>Pick a date</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <span>Choose time</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <span>Confirm</span>
          </div>
        </div>

        <div class="calendar-section">
          <div class="calendar-header">
            <button class="calendar-nav-btn" id="prevMonth" type="button" aria-label="Previous month">
              <i class="fas fa-chevron-left"></i>
            </button>
            <h3 id="currentMonthYear">November 2025</h3>
            <button class="calendar-nav-btn" id="nextMonth" type="button" aria-label="Next month">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <table class="calendar-table" aria-label="Select a Day">
            <thead>
              <tr>
                <th class="weekday-header">Mon</th>
                <th class="weekday-header">Tue</th>
                <th class="weekday-header">Wed</th>
                <th class="weekday-header">Thu</th>
                <th class="weekday-header">Fri</th>
                <th class="weekday-header">Sat</th>
                <th class="weekday-header">Sun</th>
              </tr>
            </thead>
            <tbody id="calendarGrid">
              <!-- Calendar days will be generated by JavaScript -->
            </tbody>
          </table>
        </div>

        <div class="time-slots-section">
          <div class="time-slots-header">
            <h4 id="selectedDateDisplay">Select a date to see available times</h4>
            <div class="timezone-display">
              <i class="fas fa-globe"></i>
              <span id="timezoneDisplay">Loading timezone...</span>
            </div>
          </div>

          <div class="time-slots-wrapper">
            <div class="time-slots" id="timeSlots">
              <div class="no-date-selected">
                <i class="fas fa-arrow-left"></i>
                <p>Select a date from the calendar to view available times</p>
              </div>
            </div>
          </div>

        </div>

        <button type="submit" form="bookingForm" class="booking-submit-btn" id="submitBooking" disabled>
          <span class="btn-content">
            <i class="fas fa-check"></i>
            <span>Confirm My Spot</span>
          </span>
          <span class="btn-loader" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Booking...</span>
          </span>
        </button>

        <!-- Cancellation Policy -->
        <p class="cancellation-note">
          <i class="fas fa-info-circle"></i>
          Free cancellation up to 2 hours before your call
        </p>
      </div>
    </div>

    <!-- Success State -->
    <div class="booking-success" id="bookingSuccess" style="display: none;">
      <div class="success-animation">
        <div class="success-confetti">
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
        </div>
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>You're All Set! üéâ</h2>
        <p class="success-details" id="successDetails"></p>

        <div class="success-next-steps">
          <h3>What happens next?</h3>
          <div class="next-step">
            <div class="step-icon">üìß</div>
            <div class="step-content">
              <strong>Calendar invite sent</strong>
              <span>Check your email for meeting details and add to your calendar</span>
            </div>
          </div>
          <div class="next-step">
            <div class="step-icon">üîî</div>
            <div class="step-content">
              <strong>Reminder 24h before</strong>
              <span>We'll send you a friendly reminder the day before</span>
            </div>
          </div>
          <div class="next-step">
            <div class="step-icon">üí¨</div>
            <div class="step-content">
              <strong>Come prepared</strong>
              <span>Think about your automation goals and current challenges</span>
            </div>
          </div>
        </div>

        <div class="success-actions">
          <button class="booking-done-btn primary" id="addToCalendar">
            <i class="fas fa-calendar-plus"></i> Add to Calendar
          </button>
          <button class="booking-done-btn secondary" id="bookingDone">
            Done
          </button>
        </div>

        <p class="success-footer">
          Need to reschedule? Just reply to the calendar invite.
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  /* Modal Base */
  .booking-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .booking-modal.active {
    opacity: 1;
    visibility: visible;
  }

  .booking-modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 14, 26, 0.97);
    backdrop-filter: blur(12px);
    pointer-events: none;
  }

  .booking-modal-content {
    position: relative;
    z-index: 10;
    background: linear-gradient(135deg, rgba(17, 24, 39, 0.98), rgba(15, 23, 42, 0.98));
    border: 2px solid rgba(99, 102, 241, 0.3);
    border-radius: 24px;
    max-width: 1300px;
    width: 95%;
    max-height: 95vh;
    overflow-y: auto;
    box-shadow: 0 30px 90px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(99, 102, 241, 0.1);
    animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes slideUp {
    from {
      transform: translateY(40px) scale(0.96);
      opacity: 0;
    }
    to {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }

  .booking-modal-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(99, 102, 241, 0.15);
    border: 2px solid rgba(99, 102, 241, 0.3);
    color: #818cf8;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
  }

  .booking-modal-close:hover {
    background: rgba(99, 102, 241, 0.3);
    border-color: #6366f1;
    transform: rotate(90deg);
    color: white;
  }

  /* Trust Banner - CRO Element */
  .trust-banner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    padding: 1rem 2rem;
    background: rgba(99, 102, 241, 0.08);
    border-bottom: 2px solid rgba(99, 102, 241, 0.2);
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(226, 232, 240, 0.9);
    font-size: 0.85rem;
    font-weight: 600;
  }

  .trust-item i {
    color: #22c55e;
    font-size: 1rem;
  }

  /* Container Layout */
  .booking-container {
    display: grid;
    grid-template-columns: 480px 1fr;
    min-height: 700px;
  }

  /* Left Side - Form */
  .booking-left {
    background: rgba(10, 14, 26, 0.6);
    padding: 2.5rem;
    border-right: 2px solid rgba(99, 102, 241, 0.2);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  /* Header with Urgency Badge - CRO */
  .booking-header {
    margin-bottom: 2rem;
  }

  .booking-header-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: rgba(239, 68, 68, 0.15);
    border: 2px solid rgba(239, 68, 68, 0.3);
    border-radius: 50px;
    color: #fca5a5;
    font-size: 0.85rem;
    font-weight: 700;
    margin-bottom: 1.25rem;
    animation: pulse 2s ease-in-out infinite;
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    background: #ef4444;
    border-radius: 50%;
    animation: pulseDot 1.5s ease-in-out infinite;
  }

  @keyframes pulseDot {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.2);
    }
  }

  @keyframes pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
    }
  }

  .booking-header-icon {
    width: 70px;
    height: 70px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.25), rgba(139, 92, 246, 0.2));
    border: 3px solid rgba(99, 102, 241, 0.5);
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1.25rem;
  }

  .booking-header-icon i {
    font-size: 1.8rem;
    color: #818cf8;
  }

  .booking-header h2 {
    font-size: 1.85rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #ffffff, #e0e7ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
  }

  .booking-duration {
    color: rgba(226, 232, 240, 0.8);
    font-size: 0.95rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .booking-duration i {
    color: #818cf8;
  }

  /* Value Proposition - CRO */
  .value-prop {
    background: rgba(99, 102, 241, 0.08);
    border: 2px solid rgba(99, 102, 241, 0.25);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .value-prop h3 {
    font-size: 1.1rem;
    color: white;
    margin-bottom: 1rem;
  }

  .value-list {
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
  }

  .value-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: rgba(226, 232, 240, 0.9);
    font-size: 0.95rem;
    line-height: 1.5;
  }

  .value-item i {
    color: #22c55e;
    font-size: 1rem;
    flex-shrink: 0;
    margin-top: 0.15rem;
  }

  /* Form Styling with Validation States - CRO */
  .booking-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    margin-bottom: 2rem;
  }

  .form-group {
    position: relative;
  }

  .form-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: rgba(226, 232, 240, 0.95);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }

  .form-group label i {
    color: #818cf8;
    font-size: 0.85rem;
    width: 16px;
  }

  .form-group input,
  .form-group textarea {
    width: 100%;
    background: rgba(99, 102, 241, 0.08);
    border: 2px solid rgba(99, 102, 241, 0.25);
    border-radius: 12px;
    padding: 0.875rem 1rem;
    padding-right: 3rem;
    color: white;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    font-family: 'Figtree', sans-serif;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #6366f1;
    background: rgba(99, 102, 241, 0.12);
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
  }

  .form-group input.valid {
    border-color: #22c55e;
    background: rgba(34, 197, 94, 0.05);
  }

  .form-group input.invalid {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.05);
  }

  .field-success {
    position: absolute;
    right: 1rem;
    top: 2.5rem;
    color: #22c55e;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .form-group input.valid ~ .field-success {
    opacity: 1;
  }

  .field-error {
    display: block;
    color: #fca5a5;
    font-size: 0.85rem;
    margin-top: 0.5rem;
    min-height: 1.2em;
  }

  .field-hint {
    color: rgba(226, 232, 240, 0.5);
    font-size: 0.85rem;
    margin-top: 0.5rem;
  }

  .char-counter {
    text-align: right;
    color: rgba(226, 232, 240, 0.5);
    font-size: 0.8rem;
    margin-top: 0.5rem;
  }

  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: rgba(226, 232, 240, 0.35);
  }

  /* Platform Selection - Enhanced */
  .platform-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
  }

  .platform-option {
    cursor: pointer;
    position: relative;
  }

  .platform-option input[type="radio"] {
    display: none;
  }

  .platform-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 0.75rem;
    background: rgba(99, 102, 241, 0.08);
    border: 2px solid rgba(99, 102, 241, 0.25);
    border-radius: 12px;
    transition: all 0.3s ease;
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(226, 232, 240, 0.8);
    position: relative;
  }

  .platform-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
    border-radius: 50px;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
  }

  .platform-card i {
    font-size: 1.5rem;
    color: #818cf8;
  }

  .platform-option input:checked + .platform-card {
    background: rgba(99, 102, 241, 0.2);
    border-color: #6366f1;
    color: white;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    transform: translateY(-2px);
  }

  .platform-card:hover {
    border-color: rgba(99, 102, 241, 0.5);
    transform: translateY(-2px);
  }

  /* Social Proof - CRO */
  .social-proof {
    background: rgba(99, 102, 241, 0.05);
    border: 2px solid rgba(99, 102, 241, 0.2);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .testimonial-mini {
    position: relative;
  }

  .quote-icon {
    position: absolute;
    top: -10px;
    left: -10px;
    color: rgba(99, 102, 241, 0.3);
    font-size: 2rem;
  }

  .testimonial-mini p {
    color: rgba(226, 232, 240, 0.9);
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 1rem;
    padding-left: 1rem;
    font-style: italic;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .author-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #6366f1, #818cf8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .author-info {
    display: flex;
    flex-direction: column;
  }

  .author-info strong {
    color: white;
    font-size: 0.9rem;
  }

  .author-info span {
    color: rgba(226, 232, 240, 0.6);
    font-size: 0.85rem;
  }

  /* Privacy & Trust */
  .booking-footer {
    padding-top: 1.5rem;
    border-top: 2px solid rgba(99, 102, 241, 0.15);
    margin-top: auto;
  }

  .privacy-note {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: rgba(226, 232, 240, 0.7);
    font-size: 0.85rem;
    line-height: 1.5;
  }

  .privacy-note i {
    color: #22c55e;
    font-size: 1rem;
    flex-shrink: 0;
    margin-top: 0.15rem;
  }

  .privacy-note a {
    color: #818cf8;
    text-decoration: underline;
  }

  /* Right Side - Calendar */
  .booking-right {
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
  }

  /* Progress Indicator - CRO */
  .booking-progress {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid rgba(99, 102, 241, 0.15);
  }

  .progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(99, 102, 241, 0.15);
    border: 2px solid rgba(99, 102, 241, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(226, 232, 240, 0.7);
    font-weight: 700;
    transition: all 0.3s ease;
  }

  .progress-step.active .step-number {
    background: linear-gradient(135deg, #6366f1, #818cf8);
    border-color: #818cf8;
    color: white;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
  }

  .progress-step.completed .step-number {
    background: #22c55e;
    border-color: #22c55e;
    color: white;
  }

  .progress-step span {
    font-size: 0.85rem;
    color: rgba(226, 232, 240, 0.6);
    font-weight: 600;
  }

  .progress-step.active span {
    color: #818cf8;
  }

  .progress-line {
    width: 60px;
    height: 2px;
    background: rgba(99, 102, 241, 0.2);
    margin: 0 0.5rem;
  }

  .progress-step.active ~ .progress-line,
  .progress-step.completed ~ .progress-line {
    background: #6366f1;
  }

  /* Calendar Section */
  .calendar-section {
    margin-bottom: 2rem;
  }

  .calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  .calendar-header h3 {
    font-size: 1.4rem;
    color: white;
  }

  .calendar-nav-btn {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: rgba(99, 102, 241, 0.15);
    border: 2px solid rgba(99, 102, 241, 0.3);
    color: #818cf8;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .calendar-nav-btn:hover {
    background: rgba(99, 102, 241, 0.25);
    border-color: #6366f1;
    color: white;
    transform: scale(1.05);
  }

  /* Calendar Grid */
  .calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .calendar-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-bottom: 1.5rem;
  }

  .weekday-header {
    text-align: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: #818cf8;
    padding: 0.5rem 0.25rem;
    border: none;
  }

  .calendar-table td {
    text-align: center;
    padding: 0.2rem;
    border: none;
  }

  .calendar-day {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: 50%;
    color: rgba(226, 232, 240, 0.9);
    font-weight: 600;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    padding: 0;
    width: 40px;
    height: 40px;
    cursor: pointer;
    font-family: inherit;
    position: relative;
    margin: 0 auto;
  }

  .calendar-day:hover:not(.disabled) {
    background: rgba(99, 102, 241, 0.15);
    transform: scale(1.1);
  }

  .calendar-day.selected {
    background: linear-gradient(135deg, #6366f1, #8b5cf6) !important;
    color: white !important;
    font-weight: 800 !important;
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6),
                0 0 0 4px rgba(99, 102, 241, 0.2) !important;
    transform: scale(1.2) !important;
    position: relative !important;
    z-index: 5 !important;
  }

  .calendar-day.selected::before {
    content: '';
    position: absolute;
    inset: -6px;
    border-radius: 12px;
    padding: 2px;
    background: linear-gradient(135deg, #818cf8, #a855f7, #6366f1);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: borderPulse 2s ease-in-out infinite;
    z-index: -1;
    pointer-events: none;
  }

  @keyframes borderPulse {
    0%, 100% {
      opacity: 0.6;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.05);
    }
  }

  .calendar-day.today:not(.selected) {
    background: rgba(99, 102, 241, 0.12);
    color: #818cf8;
    font-weight: 700;
  }

  .calendar-day.disabled {
    opacity: 0.25;
    cursor: not-allowed;
    color: rgba(226, 232, 240, 0.3);
  }

  .calendar-day.empty {
    background: transparent;
    border: none;
    cursor: default;
  }

  /* Time Slots Section */
  .time-slots-section {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .time-slots-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .time-slots-header h4 {
    font-size: 1.1rem;
    color: white;
  }

  .timezone-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: rgba(226, 232, 240, 0.7);
    font-size: 0.85rem;
  }

  .timezone-display i {
    color: #818cf8;
  }

  .time-slots-wrapper {
    flex: 1;
    margin-bottom: 1.5rem;
  }

  .time-slots {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 0.75rem;
    max-height: 230px;
    overflow-y: auto;
    padding: 0.5rem;
    border: 2px solid rgba(99, 102, 241, 0.15);
    border-radius: 12px;
    background: rgba(99, 102, 241, 0.03);
  }

  .no-date-selected {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem 1rem;
    color: rgba(226, 232, 240, 0.5);
  }

  .no-date-selected i {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: block;
    color: rgba(99, 102, 241, 0.3);
    animation: bounce 2s ease-in-out infinite;
  }

  @keyframes bounce {
    0%, 100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(-10px);
    }
  }

  .time-slot {
    padding: 0.75rem 1.25rem;
    background: rgba(99, 102, 241, 0.08);
    border: 2px solid rgba(99, 102, 241, 0.25);
    border-radius: 50px;
    text-align: center;
    color: rgba(226, 232, 240, 0.9);
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    white-space: nowrap;
  }

  .time-slot:hover:not(.booked) {
    background: rgba(99, 102, 241, 0.15);
    border-color: rgba(99, 102, 241, 0.4);
    transform: translateY(-2px);
    color: white;
  }

  .time-slot.selected {
    background: linear-gradient(135deg, #6366f1, #818cf8);
    border-color: #818cf8;
    color: white;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
  }

  .time-slot.booked {
    opacity: 0.4;
    cursor: not-allowed;
    text-decoration: line-through;
  }

  /* Popular Times Note - CRO */
  .popular-times-note {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: rgba(251, 146, 60, 0.1);
    border: 2px solid rgba(251, 146, 60, 0.2);
    border-radius: 10px;
    color: #fbbf24;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
  }

  .popular-times-note i {
    color: #fb923c;
  }

  /* Submit Button - Enhanced CRO */
  .booking-submit-btn {
    width: 100%;
    padding: 1.25rem 2rem;
    background: linear-gradient(135deg, #6366f1, #818cf8);
    border: 2px solid rgba(129, 140, 248, 0.4);
    border-radius: 14px;
    color: white;
    font-weight: 700;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .booking-submit-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .booking-submit-btn:hover:not(:disabled)::before {
    width: 300px;
    height: 300px;
  }

  .btn-content,
  .btn-loader {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    z-index: 1;
  }

  .booking-submit-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
  }

  .booking-submit-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Cancellation Note - CRO Trust Signal */
  .cancellation-note {
    text-align: center;
    color: rgba(226, 232, 240, 0.6);
    font-size: 0.85rem;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .cancellation-note i {
    color: #818cf8;
  }

  /* Success State - Enhanced */
  .booking-success {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(17, 24, 39, 0.98), rgba(15, 23, 42, 0.98));
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 3rem;
    overflow: hidden;
  }

  .success-confetti {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #6366f1;
    animation: confetti-fall 3s ease-out forwards;
  }

  .confetti:nth-child(1) {
    left: 10%;
    animation-delay: 0s;
    background: #22c55e;
  }

  .confetti:nth-child(2) {
    left: 30%;
    animation-delay: 0.2s;
    background: #818cf8;
  }

  .confetti:nth-child(3) {
    left: 50%;
    animation-delay: 0.4s;
    background: #fbbf24;
  }

  .confetti:nth-child(4) {
    left: 70%;
    animation-delay: 0.6s;
    background: #f87171;
  }

  .confetti:nth-child(5) {
    left: 90%;
    animation-delay: 0.8s;
    background: #a78bfa;
  }

  @keyframes confetti-fall {
    to {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  .success-animation {
    text-align: center;
    max-width: 600px;
    position: relative;
    z-index: 1;
  }

  .success-icon {
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.15));
    border: 3px solid rgba(34, 197, 94, 0.5);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2rem;
    animation: successPulse 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes successPulse {
    0% { transform: scale(0) rotate(-180deg); }
    50% { transform: scale(1.2) rotate(10deg); }
    100% { transform: scale(1) rotate(0deg); }
  }

  .success-icon i {
    font-size: 3.5rem;
    color: #22c55e;
  }

  .success-animation h2 {
    font-size: 2.25rem;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #ffffff, #e0e7ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .success-details {
    font-size: 1.15rem;
    color: #818cf8;
    font-weight: 600;
    margin-bottom: 2rem;
    padding: 1.25rem;
    background: rgba(99, 102, 241, 0.1);
    border-radius: 12px;
    border: 2px solid rgba(99, 102, 241, 0.2);
    line-height: 1.6;
  }

  /* Next Steps - CRO */
  .success-next-steps {
    text-align: left;
    margin-bottom: 2rem;
  }

  .success-next-steps h3 {
    font-size: 1.25rem;
    color: white;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .next-step {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: rgba(99, 102, 241, 0.05);
    border: 2px solid rgba(99, 102, 241, 0.15);
    border-radius: 12px;
    margin-bottom: 1rem;
  }

  .step-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }

  .step-content {
    flex: 1;
  }

  .step-content strong {
    display: block;
    color: white;
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }

  .step-content span {
    color: rgba(226, 232, 240, 0.7);
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .success-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .booking-done-btn {
    flex: 1;
    padding: 1rem 2rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    border: 2px solid transparent;
  }

  .booking-done-btn.primary {
    background: linear-gradient(135deg, #6366f1, #818cf8);
    border-color: rgba(129, 140, 248, 0.4);
    color: white;
  }

  .booking-done-btn.primary:hover {
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(99, 102, 241, 0.6);
  }

  .booking-done-btn.secondary {
    background: transparent;
    border-color: rgba(99, 102, 241, 0.3);
    color: #818cf8;
  }

  .booking-done-btn.secondary:hover {
    background: rgba(99, 102, 241, 0.1);
    border-color: #6366f1;
  }

  .success-footer {
    color: rgba(226, 232, 240, 0.6);
    font-size: 0.9rem;
  }

  /* Responsive */
  @media (max-width: 1100px) {
    .booking-container {
      grid-template-columns: 1fr;
    }

    .booking-left {
      border-right: none;
      border-bottom: 2px solid rgba(99, 102, 241, 0.2);
    }
  }

  @media (max-width: 768px) {
    .trust-banner {
      flex-direction: column;
      gap: 0.75rem;
      padding: 1rem;
    }

    .booking-left,
    .booking-right {
      padding: 2rem 1.5rem;
    }

    .calendar-grid {
      gap: 0.35rem;
    }

    .calendar-day {
      font-size: 0.85rem;
    }

    .time-slots {
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 0.5rem;
    }

    .platform-options {
      grid-template-columns: 1fr;
    }

    .booking-progress {
      transform: scale(0.9);
    }

    .success-actions {
      flex-direction: column;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('bookingModal');
    const overlay = document.getElementById('bookingModalOverlay');
    const closeBtn = document.getElementById('bookingModalClose');
    const bookingForm = document.getElementById('bookingForm');
    const submitBtn = document.getElementById('submitBooking');
    const bookingSuccess = document.getElementById('bookingSuccess');
    const bookingContainer = document.querySelector('.booking-container');

    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;

    // Business hours: 9 AM to 8 PM (20:00)
    const businessHours = {
      start: 9,
      end: 20
    };

    // Detect and display user's timezone
    const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    document.getElementById('timezoneDisplay').textContent = userTimezone.replace('_', ' ');

    // Real-time form validation - CRO best practice (declare before renderCalendar)
    const nameInput = document.getElementById('fullName');
    const emailInput = document.getElementById('email');
    const messageInput = document.getElementById('message');

    // Initialize calendar (after input declarations)
    renderCalendar();

    nameInput.addEventListener('input', (e) => {
      validateName(e.target);
      updateProgress();
    });

    emailInput.addEventListener('input', (e) => {
      validateEmail(e.target);
      updateProgress();
    });

    messageInput.addEventListener('input', (e) => {
      const charCount = e.target.value.length;
      document.getElementById('charCount').textContent = charCount;
    });

    function validateName(input) {
      const value = input.value.trim();
      if (value.length >= 2) {
        input.classList.remove('invalid');
        input.classList.add('valid');
        document.getElementById('nameError').textContent = '';
        return true;
      } else if (value.length > 0) {
        input.classList.remove('valid');
        input.classList.add('invalid');
        document.getElementById('nameError').textContent = 'Name must be at least 2 characters';
        return false;
      }
      input.classList.remove('valid', 'invalid');
      return false;
    }

    function validateEmail(input) {
      const value = input.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (emailRegex.test(value)) {
        input.classList.remove('invalid');
        input.classList.add('valid');
        document.getElementById('emailError').textContent = '';
        return true;
      } else if (value.length > 0) {
        input.classList.remove('valid');
        input.classList.add('invalid');
        document.getElementById('emailError').textContent = 'Please enter a valid email address';
        return false;
      }
      input.classList.remove('valid', 'invalid');
      return false;
    }

    function updateProgress() {
      const steps = document.querySelectorAll('.progress-step');

      // Step 1: Date selected
      if (selectedDate) {
        steps[0].classList.add('completed');
        steps[1].classList.add('active');
      }

      // Step 2: Time selected
      if (selectedTime) {
        steps[1].classList.add('completed');
        steps[2].classList.add('active');
      }
    }

    // Calendar navigation
    document.getElementById('prevMonth').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    });

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();

      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('currentMonthYear').textContent = `${monthNames[month]} ${year}`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();

      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';

      const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
      const totalCells = adjustedFirstDay + daysInMonth;
      const rows = Math.ceil(totalCells / 7);

      let todayElement = null;
      let todayDate = null;
      let dayCounter = 1;
      let cellIndex = 0;

      for (let row = 0; row < rows; row++) {
        const tr = document.createElement('tr');

        for (let col = 0; col < 7; col++) {
          const td = document.createElement('td');
          td.setAttribute('role', 'gridcell');

          if (cellIndex >= adjustedFirstDay && dayCounter <= daysInMonth) {
            const dayDate = new Date(year, month, dayCounter);
            const dayButton = document.createElement('button');
            dayButton.className = 'calendar-day';
            dayButton.type = 'button';
            dayButton.setAttribute('aria-label', dayDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }));

            const daySpan = document.createElement('span');
            daySpan.textContent = dayCounter;
            dayButton.appendChild(daySpan);

            if (dayDate < today.setHours(0, 0, 0, 0)) {
              dayButton.classList.add('disabled');
              dayButton.disabled = true;
            } else {
              const isToday = dayDate.toDateString() === new Date().toDateString();
              if (isToday) {
                dayButton.classList.add('today');
                dayButton.setAttribute('aria-current', 'date');
                todayElement = dayButton;
                todayDate = dayDate;
              }

              dayButton.addEventListener('click', () => selectDate(dayDate, dayButton));
            }

            td.appendChild(dayButton);
            dayCounter++;
          }

          tr.appendChild(td);
          cellIndex++;
        }

        calendarGrid.appendChild(tr);
      }

      // Auto-select today's date if it's in the current month and not already selected
      if (todayElement && todayDate && !selectedDate) {
        selectDate(todayDate, todayElement);
      }
    }

    function selectDate(date, element) {
      // Clear all selected days
      document.querySelectorAll('.calendar-day.selected').forEach(day => {
        day.classList.remove('selected');
        day.style.cssText = ''; // Clear inline styles
        console.log('Removing selected from:', day.textContent);
      });

      // Add selected to clicked element
      element.classList.add('selected');
      // Force the styling with inline styles to override any caching issues
      element.style.width = '40px';
      element.style.height = '40px';
      element.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
      element.style.border = '3px solid #a855f7';
      element.style.borderRadius = '50%';
      element.style.color = 'white';
      element.style.fontWeight = '800';
      element.style.transform = 'scale(1.2)';
      element.style.boxShadow = '0 8px 25px rgba(99, 102, 241, 0.6), 0 0 0 4px rgba(99, 102, 241, 0.2)';
      element.style.position = 'relative';
      element.style.zIndex = '5';
      element.style.display = 'flex';
      element.style.alignItems = 'center';
      element.style.justifyContent = 'center';
      element.style.flexShrink = '0';
      console.log('Selected element:', element.textContent, 'Classes:', element.className);

      selectedDate = date;
      selectedTime = null;

      // Clear selected time slots
      document.querySelectorAll('.time-slot.selected').forEach(slot => {
        slot.classList.remove('selected');
      });

      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('selectedDateDisplay').textContent = date.toLocaleDateString('en-US', options);

      renderTimeSlots();
      updateProgress();
      updateSubmitButton();
    }

    async function renderTimeSlots() {
      const timeSlotsContainer = document.getElementById('timeSlots');

      // Don't render if no date selected
      if (!selectedDate) {
        timeSlotsContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #818cf8;">Please select a date first</div>';
        return;
      }

      timeSlotsContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #818cf8;">Loading available times...</div>';

      try {
        // Fetch availability from API
        const response = await fetch('/api/check-availability', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            date: selectedDate.toISOString()
          })
        });

        const data = await response.json();
        const bookedHours = data.bookedHours || [];

        timeSlotsContainer.innerHTML = '';

        let firstAvailableSlot = null;
        let firstAvailableHour = null;

        for (let hour = businessHours.start; hour < businessHours.end; hour++) {
          const timeSlot = document.createElement('div');
          timeSlot.className = 'time-slot';

          const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour;
          const period = hour >= 12 ? 'PM' : 'AM';
          const timeString = `${displayHour}:00 ${period}`;

          timeSlot.textContent = timeString;
          timeSlot.dataset.hour = hour;

          // Check if this hour is booked
          if (bookedHours.includes(hour)) {
            timeSlot.classList.add('booked');
          } else {
            timeSlot.addEventListener('click', () => selectTime(hour, timeSlot));
            // Track first available slot
            if (!firstAvailableSlot) {
              firstAvailableSlot = timeSlot;
              firstAvailableHour = hour;
            }
          }

          timeSlotsContainer.appendChild(timeSlot);
        }

        // Auto-select first available time slot
        if (firstAvailableSlot && firstAvailableHour && !selectedTime) {
          selectTime(firstAvailableHour, firstAvailableSlot);
        }
      } catch (error) {
        console.error('Error fetching availability:', error);
        timeSlotsContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed to load times. Please try again.</div>';
      }
    }

    function selectTime(hour, element) {
      document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
        slot.style.cssText = ''; // Clear inline styles
      });

      element.classList.add('selected');
      // Apply circular styling to time slot
      element.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
      element.style.border = '2px solid #a855f7';
      element.style.borderRadius = '50px';
      element.style.color = 'white';
      element.style.fontWeight = '700';
      element.style.transform = 'scale(1.05)';
      element.style.boxShadow = '0 4px 15px rgba(99, 102, 241, 0.4)';

      selectedTime = hour;
      updateProgress();
      updateSubmitButton();
    }

    function updateSubmitButton() {
      const formValid = nameInput.classList.contains('valid') &&
                       emailInput.classList.contains('valid') &&
                       document.querySelector('input[name="platform"]:checked');
      submitBtn.disabled = !(selectedDate && selectedTime && formValid);
    }

    bookingForm.addEventListener('input', updateSubmitButton);

    bookingForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!selectedDate || !selectedTime) {
        alert('Please select a date and time');
        return;
      }

      // Show loading state
      submitBtn.querySelector('.btn-content').style.display = 'none';
      submitBtn.querySelector('.btn-loader').style.display = 'flex';
      submitBtn.disabled = true;

      const formData = {
        fullName: nameInput.value,
        email: emailInput.value,
        phone: document.getElementById('phone').value,
        company: document.getElementById('company').value,
        platform: document.querySelector('input[name="platform"]:checked').value,
        message: messageInput.value,
        date: selectedDate.toISOString(),
        time: selectedTime,
        timezone: userTimezone
      };

      console.log('Submitting booking with data:', formData);

      try {
        // Call the booking API
        const response = await fetch('/api/book-meeting', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
          console.log('Booking successful:', result);
          showSuccess(formData);
        } else {
          throw new Error(result.error || 'Booking failed');
        }
      } catch (error) {
        console.error('Booking error:', error);

        // Reset button state
        submitBtn.querySelector('.btn-content').style.display = 'flex';
        submitBtn.querySelector('.btn-loader').style.display = 'none';
        submitBtn.disabled = false;

        alert('Failed to create booking. Please try again or contact us directly.');
      }
    });

    function showSuccess(data) {
      const displayHour = data.time > 12 ? data.time - 12 : data.time === 0 ? 12 : data.time;
      const period = data.time >= 12 ? 'PM' : 'AM';
      const dateString = selectedDate.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const platformNames = {
        zoom: 'Zoom',
        teams: 'Microsoft Teams',
        phone: 'Phone Call'
      };

      document.getElementById('successDetails').innerHTML = `
        üìÖ ${dateString}<br>
        üïê ${displayHour}:00 ${period} (${data.timezone})<br>
        üíº ${platformNames[data.platform]}
      `;

      bookingContainer.style.display = 'none';
      bookingSuccess.style.display = 'block';

      // Reset loading state
      submitBtn.querySelector('.btn-content').style.display = 'flex';
      submitBtn.querySelector('.btn-loader').style.display = 'none';
    }

    function closeModal() {
      modal.classList.remove('active');
      setTimeout(() => {
        bookingContainer.style.display = 'grid';
        bookingSuccess.style.display = 'none';
        bookingForm.reset();
        selectedDate = null;
        selectedTime = null;
        nameInput.classList.remove('valid', 'invalid');
        emailInput.classList.remove('valid', 'invalid');
        document.getElementById('charCount').textContent = '0';
        document.getElementById('timeSlots').innerHTML = `
          <div class="no-date-selected">
            <i class="fas fa-arrow-left"></i>
            <p>Select a date from the calendar to view available times</p>
          </div>
        `;
        document.getElementById('selectedDateDisplay').textContent = 'Select a date to see available times';
        document.querySelectorAll('.progress-step').forEach((step, i) => {
          if (i === 0) {
            step.classList.add('active');
          } else {
            step.classList.remove('active', 'completed');
          }
        });
        renderCalendar();
        updateSubmitButton();
      }, 300);
    }

    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);
    document.getElementById('bookingDone').addEventListener('click', closeModal);

    // Add to calendar button
    document.getElementById('addToCalendar').addEventListener('click', () => {
      // Generate calendar event (implement based on your needs)
      alert('Calendar download feature - implement based on platform');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });

    window.openBookingModal = () => {
      modal.classList.add('active');
    };
  });
</script>
